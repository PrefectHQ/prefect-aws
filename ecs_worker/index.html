
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Worker integration with the Amazon Elastic Container Service.">
      
      
      
        <link rel="canonical" href="https://PrefectHQ.github.io/prefect-aws/ecs_worker/">
      
      
        <link rel="prev" href="../credentials/">
      
      
        <link rel="next" href="../ecs/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.19">
    
    
      
        <title>ECS Worker - prefect-aws</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8CSMBCQDKN"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-8CSMBCQDKN');
</script>
<!-- Segment analytics -->
<script>
    !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="xDLAoTXsNYpC4Y6JucKnJ8W1MYBuyAbD";;analytics.SNIPPET_VERSION="4.15.3";
    analytics.load("xDLAoTXsNYpC4Y6JucKnJ8W1MYBuyAbD");
    analytics.page();
    }}();
</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prefect_aws.workers.ecs_worker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="prefect-aws" class="md-header__button md-logo" aria-label="prefect-aws" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            prefect-aws
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ECS Worker
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PrefectHQ/prefect-aws" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="prefect-aws" class="md-nav__button md-logo" aria-label="prefect-aws" data-md-component="logo">
      
  <img src="../img/prefect-logo-mark.png" alt="logo">

    </a>
    prefect-aws
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PrefectHQ/prefect-aws" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ecs_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECS Worker Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../blocks_catalog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blocks Catalog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples_catalog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples Catalog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Batch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client_waiter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client Waiter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ECS Worker
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ECS Worker
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.CapacityProvider" class="md-nav__link">
    <span class="md-ellipsis">
      CapacityProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier" class="md-nav__link">
    <span class="md-ellipsis">
      ECSIdentifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSIdentifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier.__getnewargs__" class="md-nav__link">
    <span class="md-ellipsis">
      __getnewargs__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      ECSJobConfiguration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSJobConfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.cloudwatch_logs_options_requires_configure_cloudwatch_logs" class="md-nav__link">
    <span class="md-ellipsis">
      cloudwatch_logs_options_requires_configure_cloudwatch_logs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.configure_cloudwatch_logs_requires_execution_role_arn" class="md-nav__link">
    <span class="md-ellipsis">
      configure_cloudwatch_logs_requires_execution_role_arn()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.container_name_default_from_task_definition" class="md-nav__link">
    <span class="md-ellipsis">
      container_name_default_from_task_definition()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.network_configuration_requires_vpc_id" class="md-nav__link">
    <span class="md-ellipsis">
      network_configuration_requires_vpc_id()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.set_default_configure_cloudwatch_logs" class="md-nav__link">
    <span class="md-ellipsis">
      set_default_configure_cloudwatch_logs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.task_run_request_requires_arn_if_no_task_definition_given" class="md-nav__link">
    <span class="md-ellipsis">
      task_run_request_requires_arn_if_no_task_definition_given()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables" class="md-nav__link">
    <span class="md-ellipsis">
      ECSVariables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSVariables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.auto_deregister_task_definition" class="md-nav__link">
    <span class="md-ellipsis">
      auto_deregister_task_definition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.aws_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      aws_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.capacity_provider_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      capacity_provider_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cloudwatch_logs_options" class="md-nav__link">
    <span class="md-ellipsis">
      cloudwatch_logs_options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cloudwatch_logs_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      cloudwatch_logs_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cluster" class="md-nav__link">
    <span class="md-ellipsis">
      cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.configure_cloudwatch_logs" class="md-nav__link">
    <span class="md-ellipsis">
      configure_cloudwatch_logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.container_name" class="md-nav__link">
    <span class="md-ellipsis">
      container_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cpu" class="md-nav__link">
    <span class="md-ellipsis">
      cpu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.execution_role_arn" class="md-nav__link">
    <span class="md-ellipsis">
      execution_role_arn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.family" class="md-nav__link">
    <span class="md-ellipsis">
      family
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.image" class="md-nav__link">
    <span class="md-ellipsis">
      image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.launch_type" class="md-nav__link">
    <span class="md-ellipsis">
      launch_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.match_latest_revision_in_family" class="md-nav__link">
    <span class="md-ellipsis">
      match_latest_revision_in_family
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.memory" class="md-nav__link">
    <span class="md-ellipsis">
      memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.network_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      network_configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.stream_output" class="md-nav__link">
    <span class="md-ellipsis">
      stream_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_definition_arn" class="md-nav__link">
    <span class="md-ellipsis">
      task_definition_arn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_role_arn" class="md-nav__link">
    <span class="md-ellipsis">
      task_role_arn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_start_timeout_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      task_start_timeout_seconds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_watch_poll_interval" class="md-nav__link">
    <span class="md-ellipsis">
      task_watch_poll_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.vpc_id" class="md-nav__link">
    <span class="md-ellipsis">
      vpc_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker" class="md-nav__link">
    <span class="md-ellipsis">
      ECSWorker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSWorker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      job_configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="job_configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables" class="md-nav__link">
    <span class="md-ellipsis">
      job_configuration_variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="job_configuration_variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.kill_infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      kill_infrastructure()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.run" class="md-nav__link">
    <span class="md-ellipsis">
      run()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorkerResult" class="md-nav__link">
    <span class="md-ellipsis">
      ECSWorkerResult
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.parse_identifier" class="md-nav__link">
    <span class="md-ellipsis">
      parse_identifier()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ecs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lambda_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployments
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            Deployments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployments/steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Steps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glue_job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glue Job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../secrets_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secrets Manager
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.CapacityProvider" class="md-nav__link">
    <span class="md-ellipsis">
      CapacityProvider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier" class="md-nav__link">
    <span class="md-ellipsis">
      ECSIdentifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSIdentifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier.__getnewargs__" class="md-nav__link">
    <span class="md-ellipsis">
      __getnewargs__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSIdentifier.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      ECSJobConfiguration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSJobConfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.cloudwatch_logs_options_requires_configure_cloudwatch_logs" class="md-nav__link">
    <span class="md-ellipsis">
      cloudwatch_logs_options_requires_configure_cloudwatch_logs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.configure_cloudwatch_logs_requires_execution_role_arn" class="md-nav__link">
    <span class="md-ellipsis">
      configure_cloudwatch_logs_requires_execution_role_arn()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.container_name_default_from_task_definition" class="md-nav__link">
    <span class="md-ellipsis">
      container_name_default_from_task_definition()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.network_configuration_requires_vpc_id" class="md-nav__link">
    <span class="md-ellipsis">
      network_configuration_requires_vpc_id()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.set_default_configure_cloudwatch_logs" class="md-nav__link">
    <span class="md-ellipsis">
      set_default_configure_cloudwatch_logs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSJobConfiguration.task_run_request_requires_arn_if_no_task_definition_given" class="md-nav__link">
    <span class="md-ellipsis">
      task_run_request_requires_arn_if_no_task_definition_given()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables" class="md-nav__link">
    <span class="md-ellipsis">
      ECSVariables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSVariables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.auto_deregister_task_definition" class="md-nav__link">
    <span class="md-ellipsis">
      auto_deregister_task_definition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.aws_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      aws_credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.capacity_provider_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      capacity_provider_strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cloudwatch_logs_options" class="md-nav__link">
    <span class="md-ellipsis">
      cloudwatch_logs_options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cloudwatch_logs_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      cloudwatch_logs_prefix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cluster" class="md-nav__link">
    <span class="md-ellipsis">
      cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.configure_cloudwatch_logs" class="md-nav__link">
    <span class="md-ellipsis">
      configure_cloudwatch_logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.container_name" class="md-nav__link">
    <span class="md-ellipsis">
      container_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.cpu" class="md-nav__link">
    <span class="md-ellipsis">
      cpu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.execution_role_arn" class="md-nav__link">
    <span class="md-ellipsis">
      execution_role_arn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.family" class="md-nav__link">
    <span class="md-ellipsis">
      family
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.image" class="md-nav__link">
    <span class="md-ellipsis">
      image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.launch_type" class="md-nav__link">
    <span class="md-ellipsis">
      launch_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.match_latest_revision_in_family" class="md-nav__link">
    <span class="md-ellipsis">
      match_latest_revision_in_family
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.memory" class="md-nav__link">
    <span class="md-ellipsis">
      memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.network_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      network_configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.stream_output" class="md-nav__link">
    <span class="md-ellipsis">
      stream_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_definition_arn" class="md-nav__link">
    <span class="md-ellipsis">
      task_definition_arn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_role_arn" class="md-nav__link">
    <span class="md-ellipsis">
      task_role_arn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_start_timeout_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      task_start_timeout_seconds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.task_watch_poll_interval" class="md-nav__link">
    <span class="md-ellipsis">
      task_watch_poll_interval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSVariables.vpc_id" class="md-nav__link">
    <span class="md-ellipsis">
      vpc_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker" class="md-nav__link">
    <span class="md-ellipsis">
      ECSWorker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ECSWorker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      job_configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="job_configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables" class="md-nav__link">
    <span class="md-ellipsis">
      job_configuration_variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="job_configuration_variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.kill_infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      kill_infrastructure()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorker.run" class="md-nav__link">
    <span class="md-ellipsis">
      run()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.ECSWorkerResult" class="md-nav__link">
    <span class="md-ellipsis">
      ECSWorkerResult
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefect_aws.workers.ecs_worker.parse_identifier" class="md-nav__link">
    <span class="md-ellipsis">
      parse_identifier()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div class="doc doc-object doc-module">



<h1 id="prefect_aws.workers.ecs_worker" class="doc doc-heading">
        <code>prefect_aws.workers.ecs_worker</code>



</h1>

    <div class="doc doc-contents first">

      <p>Prefect worker for executing flow runs as ECS tasks.</p>
<p>Get started by creating a work pool:</p>
<div class="highlight"><pre><span></span><code>$ prefect work-pool create --type ecs my-ecs-pool
</code></pre></div>
<p>Then, you can start a worker for the pool:</p>
<div class="highlight"><pre><span></span><code>$ prefect worker start --pool my-ecs-pool
</code></pre></div>
<p>It's common to deploy the worker as an ECS task as well. However, you can run the worker
locally to get started.</p>
<p>The worker may work without any additional configuration, but it is dependent on your
specific AWS setup and we'd recommend opening the work pool editor in the UI to see the
available options.</p>
<p>By default, the worker will register a task definition for each flow run and run a task
in your default ECS cluster using AWS Fargate. Fargate requires tasks to configure
subnets, which we will infer from your default VPC. If you do not have a default VPC,
you must provide a VPC ID or manually setup the network configuration for your tasks.</p>
<p>Note, the worker caches task definitions for each deployment to avoid excessive
registration. The worker will check that the cached task definition is compatible with
your configuration before using it.</p>
<p>The launch type option can be used to run your tasks in different modes. For example,
<code>FARGATE_SPOT</code> can be used to use spot instances for your Fargate tasks or <code>EC2</code> can be
used to run your tasks on a cluster backed by EC2 instances.</p>
<p>Generally, it is very useful to enable CloudWatch logging for your ECS tasks; this can
help you debug task failures. To enable CloudWatch logging, you must provide an
execution role ARN with permissions to create and write to log streams. See the
<code>configure_cloudwatch_logs</code> field documentation for details.</p>
<p>The worker can be configured to use an existing task definition by setting the task
definition arn variable or by providing a "taskDefinition" in the task run request. When
a task definition is provided, the worker will never create a new task definition which
may result in variables that are templated into the task definition payload being
ignored.</p>



  <div class="doc doc-children">


















<h2 id="prefect_aws.workers.ecs_worker-classes">Classes</h2>

  <div class="doc doc-object doc-class">



<h3 id="prefect_aws.workers.ecs_worker.CapacityProvider" class="doc doc-heading">
        <code>
CapacityProvider            (<span title="pydantic.v1.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>The capacity provider strategy to use when running the task.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CapacityProvider</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The capacity provider strategy to use when running the task.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">capacityProvider</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">base</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">





























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="prefect_aws.workers.ecs_worker.ECSIdentifier" class="doc doc-heading">
        <code>
ECSIdentifier            (<span title="tuple">tuple</span>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>The identifier for a running ECS task.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ECSIdentifier</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The identifier for a running ECS task.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cluster</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









<h4 id="prefect_aws.workers.ecs_worker.ECSIdentifier-methods">Methods</h4>

  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSIdentifier.__getnewargs__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__getnewargs__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Return self as a plain tuple.  Used by copy and pickle.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return self as a plain tuple.  Used by copy and pickle.&#39;</span>
    <span class="k">return</span> <span class="n">_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSIdentifier.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Create new instance of ECSIdentifier(cluster, task_arn)</p>

    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSIdentifier.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__repr__</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Return a nicely formatted representation string</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s1">&#39;Return a nicely formatted representation string&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">repr_fmt</span> <span class="o">%</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration" class="doc doc-heading">
        <code>
ECSJobConfiguration            (<span title="prefect.workers.base.BaseJobConfiguration">BaseJobConfiguration</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Job configuration for an ECS worker.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ECSJobConfiguration</span><span class="p">(</span><span class="n">BaseJobConfiguration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Job configuration for an ECS worker.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aws_credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AwsCredentials</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">AwsCredentials</span><span class="p">)</span>
    <span class="n">task_definition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">template</span><span class="o">=</span><span class="n">_default_task_definition_template</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">task_run_request</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">template</span><span class="o">=</span><span class="n">_default_task_run_request_template</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">configure_cloudwatch_logs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">cloudwatch_logs_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">cloudwatch_logs_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">network_configuration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">stream_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">task_start_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">task_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">auto_deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">container_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">match_latest_revision_in_family</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">task_run_request_requires_arn_if_no_task_definition_given</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If no task definition is provided, a task definition ARN must be present on the</span>
<span class="sd">        task run request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;taskDefinition&quot;</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A task definition must be provided if a task definition ARN is not &quot;</span>
                <span class="s2">&quot;present on the task run request.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">container_name_default_from_task_definition</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Infers the container name from the task definition if not provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;container_name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;container_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span>
                <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># We may not have a name here still; for example if someone is using a task</span>
            <span class="c1"># definition arn. In that case, we&#39;ll perform similar logic later to find</span>
            <span class="c1"># the name to treat as the &quot;orchestration&quot; container.</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_default_configure_cloudwatch_logs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streaming output generally requires CloudWatch logs to be configured.</span>

<span class="sd">        To avoid entangled arguments in the simple case, `configure_cloudwatch_logs`</span>
<span class="sd">        defaults to matching the value of `stream_output`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">configure_cloudwatch_logs</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">configure_cloudwatch_logs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream_output&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">configure_cloudwatch_logs_requires_execution_role_arn</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">        runtime task definition) when configuring logging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_role_arn&quot;</span><span class="p">)</span>
            <span class="c1"># TODO: Does not match</span>
            <span class="c1"># Do not raise if they&#39;ve linked to another task definition or provided</span>
            <span class="c1"># it without using our shortcuts</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;An `execution_role_arn` must be provided to use &quot;</span>
                <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs`.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">        runtime task definition) when configuring logging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cloudwatch_logs_options&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;configure_cloudwatch_logs&quot;</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`configure_cloudwatch_log` must be enabled to use &quot;</span>
                <span class="s2">&quot;`cloudwatch_logs_options`.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">network_configuration_requires_vpc_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces a `vpc_id` is provided when custom network configuration mode is</span>
<span class="sd">        enabled for network settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;network_configuration&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vpc_id&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;You must provide a `vpc_id` to enable custom `network_configuration`.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




































<h4 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration-methods">Methods</h4>


  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration.cloudwatch_logs_options_requires_configure_cloudwatch_logs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Enforces that an execution role arn is provided (or could be provided by a
runtime task definition) when configuring logging.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">    runtime task definition) when configuring logging.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cloudwatch_logs_options&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;configure_cloudwatch_logs&quot;</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;`configure_cloudwatch_log` must be enabled to use &quot;</span>
            <span class="s2">&quot;`cloudwatch_logs_options`.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration.configure_cloudwatch_logs_requires_execution_role_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_cloudwatch_logs_requires_execution_role_arn</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Enforces that an execution role arn is provided (or could be provided by a
runtime task definition) when configuring logging.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">configure_cloudwatch_logs_requires_execution_role_arn</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">    runtime task definition) when configuring logging.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_role_arn&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: Does not match</span>
        <span class="c1"># Do not raise if they&#39;ve linked to another task definition or provided</span>
        <span class="c1"># it without using our shortcuts</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;An `execution_role_arn` must be provided to use &quot;</span>
            <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs`.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration.container_name_default_from_task_definition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">container_name_default_from_task_definition</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Infers the container name from the task definition if not provided.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">container_name_default_from_task_definition</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Infers the container name from the task definition if not provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;container_name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;container_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span>
            <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># We may not have a name here still; for example if someone is using a task</span>
        <span class="c1"># definition arn. In that case, we&#39;ll perform similar logic later to find</span>
        <span class="c1"># the name to treat as the &quot;orchestration&quot; container.</span>

    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration.network_configuration_requires_vpc_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">network_configuration_requires_vpc_id</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Enforces a <code>vpc_id</code> is provided when custom network configuration mode is
enabled for network settings.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">network_configuration_requires_vpc_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforces a `vpc_id` is provided when custom network configuration mode is</span>
<span class="sd">    enabled for network settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;network_configuration&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vpc_id&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;You must provide a `vpc_id` to enable custom `network_configuration`.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration.set_default_configure_cloudwatch_logs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_default_configure_cloudwatch_logs</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Streaming output generally requires CloudWatch logs to be configured.</p>
<p>To avoid entangled arguments in the simple case, <code>configure_cloudwatch_logs</code>
defaults to matching the value of <code>stream_output</code>.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_default_configure_cloudwatch_logs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Streaming output generally requires CloudWatch logs to be configured.</span>

<span class="sd">    To avoid entangled arguments in the simple case, `configure_cloudwatch_logs`</span>
<span class="sd">    defaults to matching the value of `stream_output`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">configure_cloudwatch_logs</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">configure_cloudwatch_logs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream_output&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSJobConfiguration.task_run_request_requires_arn_if_no_task_definition_given" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_run_request_requires_arn_if_no_task_definition_given</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>If no task definition is provided, a task definition ARN must be present on the
task run request.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">task_run_request_requires_arn_if_no_task_definition_given</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If no task definition is provided, a task definition ARN must be present on the</span>
<span class="sd">    task run request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;taskDefinition&quot;</span>
    <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;A task definition must be provided if a task definition ARN is not &quot;</span>
            <span class="s2">&quot;present on the task run request.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="prefect_aws.workers.ecs_worker.ECSVariables" class="doc doc-heading">
        <code>
ECSVariables            (<span title="prefect.workers.base.BaseVariables">BaseVariables</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Variables for templating an ECS job.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ECSVariables</span><span class="p">(</span><span class="n">BaseVariables</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variables for templating an ECS job.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">task_definition_arn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;An identifier for an existing task definition to use. If set, options that&quot;</span>
            <span class="s2">&quot; require changes to the task definition will be ignored. All contents of &quot;</span>
            <span class="s2">&quot;the task definition in the job configuration will be ignored.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Environment Variables&quot;</span><span class="p">,</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Environment variables to provide to the task run. These variables are set &quot;</span>
            <span class="s2">&quot;on the Prefect container at task runtime. These will not be set on the &quot;</span>
            <span class="s2">&quot;task definition.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">aws_credentials</span><span class="p">:</span> <span class="n">AwsCredentials</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Credentials&quot;</span><span class="p">,</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">AwsCredentials</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The AWS credentials to use to connect to ECS. If not provided, credentials&quot;</span>
            <span class="s2">&quot; will be inferred from the local environment following AWS&#39;s boto client&#39;s&quot;</span>
            <span class="s2">&quot; rules.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The ECS cluster to run the task in. An ARN or name may be provided. If &quot;</span>
            <span class="s2">&quot;not provided, the default cluster will be used.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">family</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A family for the task definition. If not provided, it will be inferred &quot;</span>
            <span class="s2">&quot;from the task definition. If the task definition does not have a family, &quot;</span>
            <span class="s2">&quot;the name will be generated. When flow and deployment metadata is &quot;</span>
            <span class="s2">&quot;available, the generated name will include their names. Values for this &quot;</span>
            <span class="s2">&quot;field will be slugified to match AWS character requirements.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">launch_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FARGATE&quot;</span><span class="p">,</span> <span class="s2">&quot;EC2&quot;</span><span class="p">,</span> <span class="s2">&quot;EXTERNAL&quot;</span><span class="p">,</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Field</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">ECS_DEFAULT_LAUNCH_TYPE</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;The type of ECS task run infrastructure that should be used. Note that&quot;</span>
                <span class="s2">&quot; &#39;FARGATE_SPOT&#39; is not a formal ECS launch type, but we will configure&quot;</span>
                <span class="s2">&quot; the proper capacity provider strategy if set here.&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">capacity_provider_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CapacityProvider</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The capacity provider strategy to use when running the task. &quot;</span>
            <span class="s2">&quot;If a capacity provider strategy is specified, the selected launch&quot;</span>
            <span class="s2">&quot; type will be ignored.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The image to use for the Prefect container in the task. If this value is &quot;</span>
            <span class="s2">&quot;not null, it will override the value in the task definition. This value &quot;</span>
            <span class="s2">&quot;defaults to a Prefect base image matching your local versions.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cpu</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of CPU to provide to the ECS task. Valid amounts are &quot;</span>
            <span class="s2">&quot;specified in the AWS documentation. If not provided, a default value of &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_CPU</span><span class="si">}</span><span class="s2"> will be used unless present on the task definition.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of memory to provide to the ECS task. Valid amounts are &quot;</span>
            <span class="s2">&quot;specified in the AWS documentation. If not provided, a default value of &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_MEMORY</span><span class="si">}</span><span class="s2"> will be used unless present on the task definition.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The name of the container flow run orchestration will occur in. If not &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;specified, a default value of </span><span class="si">{</span><span class="n">ECS_DEFAULT_CONTAINER_NAME</span><span class="si">}</span><span class="s2"> will be used &quot;</span>
            <span class="s2">&quot;and if that is not found in the task definition the first container will &quot;</span>
            <span class="s2">&quot;be used.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">task_role_arn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Task Role ARN&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A role to attach to the task run. This controls the permissions of the &quot;</span>
            <span class="s2">&quot;task while it is running.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">execution_role_arn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Execution Role ARN&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;An execution role to use for the task. This controls the permissions of &quot;</span>
            <span class="s2">&quot;the task when it is launching. If this value is not null, it will &quot;</span>
            <span class="s2">&quot;override the value in the task definition. An execution role must be &quot;</span>
            <span class="s2">&quot;provided to capture logs from the container.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;VPC ID&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The AWS VPC to link the task run to. This is only applicable when using &quot;</span>
            <span class="s2">&quot;the &#39;awsvpc&#39; network mode for your task. FARGATE tasks require this &quot;</span>
            <span class="s2">&quot;network  mode, but for EC2 tasks the default network mode is &#39;bridge&#39;. &quot;</span>
            <span class="s2">&quot;If using the &#39;awsvpc&#39; network mode and this field is null, your default &quot;</span>
            <span class="s2">&quot;VPC will be used. If no default VPC can be found, the task run will fail.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">configure_cloudwatch_logs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, the Prefect container will be configured to send its output &quot;</span>
            <span class="s2">&quot;to the AWS CloudWatch logs service. This functionality requires an &quot;</span>
            <span class="s2">&quot;execution role with logs:CreateLogStream, logs:CreateLogGroup, and &quot;</span>
            <span class="s2">&quot;logs:PutLogEvents permissions. The default for this field is `False` &quot;</span>
            <span class="s2">&quot;unless `stream_output` is set.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cloudwatch_logs_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;When `configure_cloudwatch_logs` is enabled, this setting may be used to&quot;</span>
            <span class="s2">&quot; pass additional options to the CloudWatch logs configuration or override&quot;</span>
            <span class="s2">&quot; the default options. See the [AWS&quot;</span>
            <span class="s2">&quot; documentation](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/using_awslogs.html#create_awslogs_logdriver_options)&quot;</span>  <span class="c1"># noqa</span>
            <span class="s2">&quot; for available options. &quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cloudwatch_logs_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;When `configure_cloudwatch_logs` is enabled, this setting may be used to&quot;</span>
            <span class="s2">&quot; set a prefix for the log group. If not provided, the default prefix will&quot;</span>
            <span class="s2">&quot; be `prefect-logs_&lt;work_pool_name&gt;_&lt;deployment_id&gt;`. If&quot;</span>
            <span class="s2">&quot; `awslogs-stream-prefix` is present in `Cloudwatch logs options` this&quot;</span>
            <span class="s2">&quot; setting will be ignored.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">network_configuration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;When `network_configuration` is supplied it will override ECS Worker&#39;s&quot;</span>
            <span class="s2">&quot;awsvpcConfiguration that defined in the ECS task executing your workload. &quot;</span>
            <span class="s2">&quot;See the [AWS documentation](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-awsvpcconfiguration.html)&quot;</span>  <span class="c1"># noqa</span>
            <span class="s2">&quot; for available options.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">stream_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, logs will be streamed from the Prefect container to the local &quot;</span>
            <span class="s2">&quot;console. Unless you have configured AWS CloudWatch logs manually on your &quot;</span>
            <span class="s2">&quot;task definition, this requires the same prerequisites outlined in &quot;</span>
            <span class="s2">&quot;`configure_cloudwatch_logs`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">task_start_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of time to watch for the start of the ECS task &quot;</span>
            <span class="s2">&quot;before marking it as failed. The task must enter a RUNNING state to be &quot;</span>
            <span class="s2">&quot;considered started.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">task_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of time to wait between AWS API calls while monitoring the &quot;</span>
            <span class="s2">&quot;state of an ECS task.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">auto_deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, any task definitions that are created by this block will be &quot;</span>
            <span class="s2">&quot;deregistered. Existing task definitions linked by ARN will never be &quot;</span>
            <span class="s2">&quot;deregistered. Deregistering a task definition does not remove it from &quot;</span>
            <span class="s2">&quot;your AWS account, instead it will be marked as INACTIVE.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">match_latest_revision_in_family</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, the most recent active revision in the task definition &quot;</span>
            <span class="s2">&quot;family will be compared against the desired ECS task configuration. &quot;</span>
            <span class="s2">&quot;If they are equal, the existing task definition will be used instead &quot;</span>
            <span class="s2">&quot;of registering a new one. If no family is specified the default family &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s1">&quot; will be used.&#39;</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h4 id="prefect_aws.workers.ecs_worker.ECSVariables-attributes">Attributes</h4>














  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.auto_deregister_task_definition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>If enabled, any task definitions that are created by this block will be deregistered. Existing task definitions linked by ARN will never be deregistered. Deregistering a task definition does not remove it from your AWS account, instead it will be marked as INACTIVE.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.aws_credentials" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aws_credentials</span><span class="p">:</span> <span class="n">AwsCredentials</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The AWS credentials to use to connect to ECS. If not provided, credentials will be inferred from the local environment following AWS's boto client's rules.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.capacity_provider_strategy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">capacity_provider_strategy</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">prefect_aws</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">ecs_worker</span><span class="o">.</span><span class="n">CapacityProvider</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The capacity provider strategy to use when running the task. If a capacity provider strategy is specified, the selected launch type will be ignored.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.cloudwatch_logs_options" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cloudwatch_logs_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>When <code>configure_cloudwatch_logs</code> is enabled, this setting may be used to pass additional options to the CloudWatch logs configuration or override the default options. See the <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/using_awslogs.html#create_awslogs_logdriver_options">AWS documentation</a> for available options. </p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.cloudwatch_logs_prefix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cloudwatch_logs_prefix</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>When <code>configure_cloudwatch_logs</code> is enabled, this setting may be used to set a prefix for the log group. If not provided, the default prefix will be <code>prefect-logs_&lt;work_pool_name&gt;_&lt;deployment_id&gt;</code>. If <code>awslogs-stream-prefix</code> is present in <code>Cloudwatch logs options</code> this setting will be ignored.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.cluster" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cluster</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The ECS cluster to run the task in. An ARN or name may be provided. If not provided, the default cluster will be used.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.configure_cloudwatch_logs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_cloudwatch_logs</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>If enabled, the Prefect container will be configured to send its output to the AWS CloudWatch logs service. This functionality requires an execution role with logs:CreateLogStream, logs:CreateLogGroup, and logs:PutLogEvents permissions. The default for this field is <code>False</code> unless <code>stream_output</code> is set.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.container_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The name of the container flow run orchestration will occur in. If not specified, a default value of prefect will be used and if that is not found in the task definition the first container will be used.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.cpu" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cpu</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The amount of CPU to provide to the ECS task. Valid amounts are specified in the AWS documentation. If not provided, a default value of 1024 will be used unless present on the task definition.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.execution_role_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">execution_role_arn</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>An execution role to use for the task. This controls the permissions of the task when it is launching. If this value is not null, it will override the value in the task definition. An execution role must be provided to capture logs from the container.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.family" class="doc doc-heading">
<code class="highlight language-python"><span class="n">family</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>A family for the task definition. If not provided, it will be inferred from the task definition. If the task definition does not have a family, the name will be generated. When flow and deployment metadata is available, the generated name will include their names. Values for this field will be slugified to match AWS character requirements.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">image</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The image to use for the Prefect container in the task. If this value is not null, it will override the value in the task definition. This value defaults to a Prefect base image matching your local versions.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.launch_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FARGATE&#39;</span><span class="p">,</span> <span class="s1">&#39;EC2&#39;</span><span class="p">,</span> <span class="s1">&#39;EXTERNAL&#39;</span><span class="p">,</span> <span class="s1">&#39;FARGATE_SPOT&#39;</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The type of ECS task run infrastructure that should be used. Note that 'FARGATE_SPOT' is not a formal ECS launch type, but we will configure the proper capacity provider strategy if set here.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.match_latest_revision_in_family" class="doc doc-heading">
<code class="highlight language-python"><span class="n">match_latest_revision_in_family</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>If enabled, the most recent active revision in the task definition family will be compared against the desired ECS task configuration. If they are equal, the existing task definition will be used instead of registering a new one. If no family is specified the default family "prefect" will be used.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.memory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">memory</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The amount of memory to provide to the ECS task. Valid amounts are specified in the AWS documentation. If not provided, a default value of 2048 will be used unless present on the task definition.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.network_configuration" class="doc doc-heading">
<code class="highlight language-python"><span class="n">network_configuration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>When <code>network_configuration</code> is supplied it will override ECS Worker'sawsvpcConfiguration that defined in the ECS task executing your workload. See the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-awsvpcconfiguration.html">AWS documentation</a> for available options.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.stream_output" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stream_output</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>If enabled, logs will be streamed from the Prefect container to the local console. Unless you have configured AWS CloudWatch logs manually on your task definition, this requires the same prerequisites outlined in <code>configure_cloudwatch_logs</code>.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.task_definition_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_definition_arn</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>An identifier for an existing task definition to use. If set, options that require changes to the task definition will be ignored. All contents of the task definition in the job configuration will be ignored.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.task_role_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_role_arn</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>A role to attach to the task run. This controls the permissions of the task while it is running.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.task_start_timeout_seconds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_start_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The amount of time to watch for the start of the ECS task before marking it as failed. The task must enter a RUNNING state to be considered started.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.task_watch_poll_interval" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The amount of time to wait between AWS API calls while monitoring the state of an ECS task.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="prefect_aws.workers.ecs_worker.ECSVariables.vpc_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">vpc_id</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>The AWS VPC to link the task run to. This is only applicable when using the 'awsvpc' network mode for your task. FARGATE tasks require this network  mode, but for EC2 tasks the default network mode is 'bridge'. If using the 'awsvpc' network mode and this field is null, your default VPC will be used. If no default VPC can be found, the task run will fail.</p>
    </div>

  </div>










  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="prefect_aws.workers.ecs_worker.ECSWorker" class="doc doc-heading">
        <code>
ECSWorker            (<span title="prefect.workers.base.BaseWorker">BaseWorker</span>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>A Prefect worker to run flow runs as ECS tasks.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ECSWorker</span><span class="p">(</span><span class="n">BaseWorker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Prefect worker to run flow runs as ECS tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;ecs&quot;</span>
    <span class="n">job_configuration</span> <span class="o">=</span> <span class="n">ECSJobConfiguration</span>
    <span class="n">job_configuration_variables</span> <span class="o">=</span> <span class="n">ECSVariables</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Execute flow runs within containers on AWS ECS. Works with EC2 &quot;</span>
        <span class="s2">&quot;and Fargate clusters. Requires an AWS account.&quot;</span>
    <span class="p">)</span>
    <span class="n">_display_name</span> <span class="o">=</span> <span class="s2">&quot;AWS Elastic Container Service&quot;</span>
    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/ecs_worker/&quot;</span>
    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/d74b16fe84ce626345adf235a47008fea2869a60-225x225.png&quot;</span>  <span class="c1"># noqa</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">flow_run</span><span class="p">:</span> <span class="s2">&quot;FlowRun&quot;</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">anyio</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseWorkerResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a given flow run on the current worker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ecs_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ecs&quot;</span>
        <span class="p">)</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flow_run_logger</span><span class="p">(</span><span class="n">flow_run</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="n">task_arn</span><span class="p">,</span>
            <span class="n">cluster_arn</span><span class="p">,</span>
            <span class="n">task_definition</span><span class="p">,</span>
            <span class="n">is_new_task_definition</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_and_wait_for_start</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span>
            <span class="n">ecs_client</span><span class="p">,</span>
            <span class="n">configuration</span><span class="p">,</span>
            <span class="n">flow_run</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># The task identifier is &quot;{cluster}::{task}&quot; where we use the configured cluster</span>
        <span class="c1"># if set to preserve matching by name rather than arn</span>
        <span class="c1"># Note &quot;::&quot; is used despite the Prefect standard being &quot;:&quot; because ARNs contain</span>
        <span class="c1"># single colons.</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">else</span> <span class="n">cluster_arn</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;::&quot;</span>
            <span class="o">+</span> <span class="n">task_arn</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
            <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

        <span class="n">status_code</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_and_get_exit_code</span><span class="p">,</span>
            <span class="n">logger</span><span class="p">,</span>
            <span class="n">configuration</span><span class="p">,</span>
            <span class="n">task_arn</span><span class="p">,</span>
            <span class="n">cluster_arn</span><span class="p">,</span>
            <span class="n">task_definition</span><span class="p">,</span>
            <span class="n">is_new_task_definition</span> <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">auto_deregister_task_definition</span><span class="p">,</span>
            <span class="n">ecs_client</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ECSWorkerResult</span><span class="p">(</span>
            <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
            <span class="c1"># If the container does not start the exit code can be null but we must</span>
            <span class="c1"># still report a status code. We use a -1 to indicate a special code.</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span> <span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ECSClient</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a boto3 client of client_type. Will use a cached client if one exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">configuration</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_task_and_wait_for_start</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register the task definition, create the task run, and wait for it to start.</span>

<span class="sd">        Returns a tuple of</span>
<span class="sd">        - The task ARN</span>
<span class="sd">        - The task&#39;s cluster ARN</span>
<span class="sd">        - The task definition</span>
<span class="sd">        - A bool indicating if the task definition is newly registered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">)</span>
        <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_definition_arn</span><span class="p">:</span>
            <span class="n">task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_definition</span><span class="p">(</span>
                <span class="n">configuration</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">ecs_client</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span> <span class="n">flow_run</span><span class="o">=</span><span class="n">flow_run</span>
            <span class="p">)</span>
            <span class="p">(</span>
                <span class="n">task_definition_arn</span><span class="p">,</span>
                <span class="n">new_task_definition_registered</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_or_register_task_definition</span><span class="p">(</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">flow_run</span><span class="p">,</span> <span class="n">task_definition</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_definition_arn</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_definition</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Ignoring task definition in configuration since task definition&quot;</span>
                    <span class="s2">&quot; ARN is provided on the task run request.&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span>

        <span class="n">_TASK_DEFINITION_CACHE</span><span class="p">[</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_definition_arn</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using ECS task definition </span><span class="si">{</span><span class="n">task_definition_arn</span><span class="si">!r}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Task definition </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">task_definition</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">task_run_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_run_request</span><span class="p">(</span>
            <span class="n">configuration</span><span class="p">,</span>
            <span class="n">task_definition</span><span class="p">,</span>
            <span class="n">task_definition_arn</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating ECS task run...&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Task run request&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">mask_api_key</span><span class="p">(</span><span class="n">task_run_request</span><span class="p">),</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_run</span><span class="p">(</span><span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_run_request</span><span class="p">)</span>
            <span class="n">task_arn</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;taskArn&quot;</span><span class="p">]</span>
            <span class="n">cluster_arn</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;clusterArn&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_task_run_creation_failure</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="n">task_run_request</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for ECS task run to start...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_task_start</span><span class="p">(</span>
            <span class="n">logger</span><span class="p">,</span>
            <span class="n">configuration</span><span class="p">,</span>
            <span class="n">task_arn</span><span class="p">,</span>
            <span class="n">cluster_arn</span><span class="p">,</span>
            <span class="n">ecs_client</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_start_timeout_seconds</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">task_arn</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">,</span> <span class="n">new_task_definition_registered</span>

    <span class="k">def</span> <span class="nf">_get_or_register_task_definition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or register a task definition for the given flow run.</span>

<span class="sd">        Returns a tuple of the task definition ARN and a bool indicating if the task</span>
<span class="sd">        definition is newly registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="n">_TASK_DEFINITION_CACHE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">)</span>
        <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">cached_task_definition_arn</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cached_task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span>
                    <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">cached_task_definition_arn</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_task_definition</span><span class="p">[</span>
                    <span class="s2">&quot;status&quot;</span>
                <span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_definitions_equal</span><span class="p">(</span>
                    <span class="n">task_definition</span><span class="p">,</span> <span class="n">cached_task_definition</span>
                <span class="p">):</span>
                    <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">cached_task_definition_arn</span>
            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">match_latest_revision_in_family</span>
        <span class="p">):</span>
            <span class="n">family_name</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family&quot;</span><span class="p">,</span> <span class="n">ECS_DEFAULT_FAMILY</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">task_definition_from_family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span>
                    <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">family_name</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">task_definition_from_family</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_definitions_equal</span><span class="p">(</span>
                    <span class="n">task_definition</span><span class="p">,</span> <span class="n">task_definition_from_family</span>
                <span class="p">):</span>
                    <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="n">task_definition_from_family</span><span class="p">[</span>
                        <span class="s2">&quot;taskDefinitionArn&quot;</span>
                    <span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_task_definition_arn</span><span class="p">:</span>
            <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_task_definition</span><span class="p">(</span>
                <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_definition</span>
            <span class="p">)</span>
            <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="n">cached_task_definition_arn</span>

        <span class="k">return</span> <span class="n">task_definition_arn</span><span class="p">,</span> <span class="n">new_task_definition_registered</span>

    <span class="k">def</span> <span class="nf">_watch_task_and_get_exit_code</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wait for the task run to complete and retrieve the exit code of the Prefect</span>
<span class="sd">        container.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Wait for completion and stream logs</span>
        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_task_finish</span><span class="p">(</span>
            <span class="n">logger</span><span class="p">,</span>
            <span class="n">configuration</span><span class="p">,</span>
            <span class="n">task_arn</span><span class="p">,</span>
            <span class="n">cluster_arn</span><span class="p">,</span>
            <span class="n">task_definition</span><span class="p">,</span>
            <span class="n">ecs_client</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">deregister_task_definition</span><span class="p">:</span>
            <span class="n">ecs_client</span><span class="o">.</span><span class="n">deregister_task_definition</span><span class="p">(</span>
                <span class="n">taskDefinition</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
            <span class="ow">or</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
        <span class="p">)</span>

        <span class="c1"># Check the status code of the Prefect container</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;containers&quot;</span><span class="p">],</span> <span class="n">container_name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">container_name</span><span class="si">}</span><span class="s2">&#39; container missing from task: </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">status_code</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exitCode&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_container_status_code</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">container_name</span><span class="p">,</span> <span class="n">status_code</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status_code</span>

    <span class="k">def</span> <span class="nf">_report_container_status_code</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a log for the given container status code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Task exited without reporting an exit status for container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">status_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> exited successfully.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> exited with non-zero exit code </span><span class="si">{</span><span class="n">status_code</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_task_run_creation_failure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="ne">Exception</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrap common AWS task run creation failures with nicer user-facing messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># AWS generates exception types at runtime so they must be captured a bit</span>
        <span class="c1"># differently than normal.</span>
        <span class="k">if</span> <span class="s2">&quot;ClusterNotFoundException&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task, cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> not found. &quot;</span>
                <span class="s2">&quot;Confirm that the cluster is configured in your region.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="s2">&quot;No Container Instances&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="ow">and</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;EC2&quot;</span>
        <span class="p">):</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task, cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> does not appear to &quot;</span>
                <span class="s2">&quot;have any container instances associated with it. Confirm that you &quot;</span>
                <span class="s2">&quot;have EC2 container instances available.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="s2">&quot;failed to validate logger args&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="ow">and</span> <span class="s2">&quot;AccessDeniedException&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run ECS task, the attached execution role does not appear&quot;</span>
                <span class="s2">&quot; to have sufficient permissions. Ensure that the execution role&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">configuration</span><span class="o">.</span><span class="n">execution_role</span><span class="si">!r}</span><span class="s2"> has permissions&quot;</span>
                <span class="s2">&quot; logs:CreateLogStream, logs:CreateLogGroup, and logs:PutLogEvents.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_validate_task_definition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that the task definition is compatible with the configuration.</span>

<span class="sd">        Raises `ValueError` on incompatibility. Returns `None` on success.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">launch_type</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="n">ECS_DEFAULT_LAUNCH_TYPE</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">launch_type</span> <span class="o">!=</span> <span class="s2">&quot;EC2&quot;</span>
            <span class="ow">and</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Task definition does not have &#39;FARGATE&#39; in &#39;requiresCompatibilities&#39;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; and cannot be used with launch type </span><span class="si">{</span><span class="n">launch_type</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">or</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
            <span class="c1"># Only the &#39;awsvpc&#39; network mode is supported when using FARGATE</span>
            <span class="n">network_mode</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">network_mode</span> <span class="o">!=</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found network mode </span><span class="si">{</span><span class="n">network_mode</span><span class="si">!r}</span><span class="s2"> which is not compatible with &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;launch type </span><span class="si">{</span><span class="n">launch_type</span><span class="si">!r}</span><span class="s2">. Use either the &#39;EC2&#39; launch &quot;</span>
                    <span class="s2">&quot;type or the &#39;awsvpc&#39; network mode.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;executionRoleArn&quot;</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;An execution role arn must be set on the task definition to use &quot;</span>
                <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs` but no execution role &quot;</span>
                <span class="s2">&quot;was found on the task definition.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_task_definition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a new task definition with AWS.</span>

<span class="sd">        Returns the ARN.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Registering ECS task definition...&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Task definition request&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">task_definition</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">register_task_definition</span><span class="p">(</span><span class="o">**</span><span class="n">task_definition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">][</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_retrieve_task_definition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an existing task definition from AWS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;arn:aws:ecs:&quot;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieving ECS task definition </span><span class="si">{</span><span class="n">task_definition</span><span class="si">!r}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Retrieving most recent active revision from &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;ECS task family </span><span class="si">{</span><span class="n">task_definition</span><span class="si">!r}</span><span class="s2">...&quot;</span>
            <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">describe_task_definition</span><span class="p">(</span><span class="n">taskDefinition</span><span class="o">=</span><span class="n">task_definition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_wait_for_task_start</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits for an ECS task run to reach a RUNNING status.</span>

<span class="sd">        If a STOPPED status is reached instead, an exception is raised indicating the</span>
<span class="sd">        reason that the task run did not start.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_run</span><span class="p">(</span>
            <span class="n">logger</span><span class="p">,</span>
            <span class="n">configuration</span><span class="p">,</span>
            <span class="n">task_arn</span><span class="p">,</span>
            <span class="n">cluster_arn</span><span class="p">,</span>
            <span class="n">ecs_client</span><span class="p">,</span>
            <span class="n">until_status</span><span class="o">=</span><span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># TODO: It is possible that the task has passed _through_ a RUNNING</span>
            <span class="c1">#       status during the polling interval. In this case, there is not an</span>
            <span class="c1">#       exception to raise.</span>
            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;lastStatus&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stopCode&quot;</span><span class="p">)</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stoppedReason&quot;</span><span class="p">)</span>
                <span class="c1"># Generate a dynamic exception type from the AWS name</span>
                <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,),</span> <span class="p">{})(</span><span class="n">reason</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">task</span>

    <span class="k">def</span> <span class="nf">_wait_for_task_finish</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Watch an ECS task until it reaches a STOPPED status.</span>

<span class="sd">        If configured, logs from the Prefect container are streamed to stderr.</span>

<span class="sd">        Returns a description of the task on completion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">can_stream_output</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
            <span class="ow">or</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">stream_output</span><span class="p">:</span>
            <span class="n">container_def</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span>
                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">],</span> <span class="n">container_name</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">container_def</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Prefect container definition not found in &quot;</span>
                    <span class="s2">&quot;task definition. Output cannot be streamed.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">container_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Logging configuration not found on task. &quot;</span>
                    <span class="s2">&quot;Output cannot be streamed.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">container_def</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logDriver&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awslogs&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Logging configuration uses unsupported &quot;</span>
                    <span class="s2">&quot; driver {container_def[&#39;logConfiguration&#39;].get(&#39;logDriver&#39;)!r}. &quot;</span>
                    <span class="s2">&quot;Output cannot be streamed.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Prepare to stream the output</span>
                <span class="n">log_config</span> <span class="o">=</span> <span class="n">container_def</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">]</span>
                <span class="n">logs_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">)</span>
                <span class="n">can_stream_output</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Track the last log timestamp to prevent double display</span>
                <span class="n">last_log_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># Determine the name of the stream as &quot;prefix/container/run-id&quot;</span>
                <span class="n">stream_name</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">log_config</span><span class="p">[</span><span class="s2">&quot;awslogs-stream-prefix&quot;</span><span class="p">],</span>
                        <span class="n">container_name</span><span class="p">,</span>
                        <span class="n">task_arn</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Streaming output from container </span><span class="si">{</span><span class="n">container_name</span><span class="si">!r}</span><span class="s2">...&quot;</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_run</span><span class="p">(</span>
            <span class="n">logger</span><span class="p">,</span>
            <span class="n">configuration</span><span class="p">,</span>
            <span class="n">task_arn</span><span class="p">,</span>
            <span class="n">cluster_arn</span><span class="p">,</span>
            <span class="n">ecs_client</span><span class="p">,</span>
            <span class="n">current_status</span><span class="o">=</span><span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">stream_output</span> <span class="ow">and</span> <span class="n">can_stream_output</span><span class="p">:</span>
                <span class="c1"># On each poll for task run status, also retrieve available logs</span>
                <span class="n">last_log_timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_available_logs</span><span class="p">(</span>
                    <span class="n">logger</span><span class="p">,</span>
                    <span class="n">logs_client</span><span class="p">,</span>
                    <span class="n">log_group</span><span class="o">=</span><span class="n">log_config</span><span class="p">[</span><span class="s2">&quot;awslogs-group&quot;</span><span class="p">],</span>
                    <span class="n">log_stream</span><span class="o">=</span><span class="n">stream_name</span><span class="p">,</span>
                    <span class="n">last_log_timestamp</span><span class="o">=</span><span class="n">last_log_timestamp</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">task</span>

    <span class="k">def</span> <span class="nf">_stream_available_logs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">logs_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">log_group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">log_stream</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">last_log_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stream logs from the given log group and stream since the last log timestamp.</span>

<span class="sd">        Will continue on paginated responses until all logs are returned.</span>

<span class="sd">        Returns the last log timestamp which can be used to call this method in the</span>
<span class="sd">        future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_log_stream_token</span> <span class="o">=</span> <span class="s2">&quot;NO-TOKEN&quot;</span>
        <span class="n">next_log_stream_token</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># AWS will return the same token that we send once the end of the paginated</span>
        <span class="c1"># response is reached</span>
        <span class="k">while</span> <span class="n">last_log_stream_token</span> <span class="o">!=</span> <span class="n">next_log_stream_token</span><span class="p">:</span>
            <span class="n">last_log_stream_token</span> <span class="o">=</span> <span class="n">next_log_stream_token</span>

            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;logGroupName&quot;</span><span class="p">:</span> <span class="n">log_group</span><span class="p">,</span>
                <span class="s2">&quot;logStreamName&quot;</span><span class="p">:</span> <span class="n">log_stream</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">last_log_stream_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">request</span><span class="p">[</span><span class="s2">&quot;nextToken&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_log_stream_token</span>

            <span class="k">if</span> <span class="n">last_log_timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Bump the timestamp by one ms to avoid retrieving the last log again</span>
                <span class="n">request</span><span class="p">[</span><span class="s2">&quot;startTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_log_timestamp</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">logs_client</span><span class="o">.</span><span class="n">get_log_events</span><span class="p">(</span><span class="o">**</span><span class="n">request</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to read log events with request </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">last_log_timestamp</span>

            <span class="n">log_events</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">log_event</span> <span class="ow">in</span> <span class="n">log_events</span><span class="p">:</span>
                <span class="c1"># TODO: This doesn&#39;t forward to the local logger, which can be</span>
                <span class="c1">#       bad for customizing handling and understanding where the</span>
                <span class="c1">#       log is coming from, but it avoid nesting logger information</span>
                <span class="c1">#       when the content is output from a Prefect logger on the</span>
                <span class="c1">#       running infrastructure</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">],</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">last_log_timestamp</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">or</span> <span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">last_log_timestamp</span>
                <span class="p">):</span>
                    <span class="n">last_log_timestamp</span> <span class="o">=</span> <span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>

            <span class="n">next_log_stream_token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextForwardToken&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">log_events</span><span class="p">:</span>
                <span class="c1"># Stop reading pages if there was no data</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">last_log_timestamp</span>

    <span class="k">def</span> <span class="nf">_watch_task_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
        <span class="n">current_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">,</span>
        <span class="n">until_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Watches an ECS task run by querying every `poll_interval` seconds. After each</span>
<span class="sd">        query, the retrieved task is yielded. This function returns when the task run</span>
<span class="sd">        reaches a STOPPED status or the provided `until_status`.</span>

<span class="sd">        Emits a log each time the status changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_status</span> <span class="o">=</span> <span class="n">status</span> <span class="o">=</span> <span class="n">current_status</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">until_status</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">describe_tasks</span><span class="p">(</span>
                <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">task_arn</span><span class="p">],</span> <span class="n">cluster</span><span class="o">=</span><span class="n">cluster_arn</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TAGS&quot;</span><span class="p">]</span>
            <span class="p">)[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
                <span class="n">task</span> <span class="o">=</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">status</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;lastStatus&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">last_status</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ECS task status is </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

                <span class="k">yield</span> <span class="n">task</span>

                <span class="c1"># No point in continuing if the status is final</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">last_status</span> <span class="o">=</span> <span class="n">status</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Intermittently, the task will not be described. We wat to respect the</span>
                <span class="c1"># watch timeout though.</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Task not found.&quot;</span><span class="p">)</span>

            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Timed out after </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2">s while watching task for status &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">until_status</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;STOPPED&#39;</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_watch_poll_interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_or_generate_family</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets or generate a family for the task definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">family</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">family</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_work_pool_name</span> <span class="ow">and</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span>
            <span class="n">family</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_pool_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">slugify</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span>
            <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
            <span class="n">regex_pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9-_]+&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">family</span>

    <span class="k">def</span> <span class="nf">_prepare_task_definition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a task definition by inferring any defaults and merging overrides.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task_definition</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_definition</span><span class="p">)</span>

        <span class="c1"># Configure the Prefect runtime container</span>
        <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Remove empty container definitions</span>
        <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">d</span>
        <span class="p">]</span>

        <span class="n">container_name</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">container_name</span><span class="p">:</span>
            <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
            <span class="p">)</span>

        <span class="n">container</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span>
            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">],</span> <span class="n">container_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">container_name</span> <span class="o">!=</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Container </span><span class="si">{</span><span class="n">container_name</span><span class="si">!r}</span><span class="s2"> not found in task definition.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Look for a container without a name</span>
            <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">container</span><span class="p">:</span>
                    <span class="n">container</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">container_name</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">container</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">container_name</span><span class="p">}</span>
                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

        <span class="c1"># Image is required so make sure it&#39;s present</span>
        <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">get_prefect_image_name</span><span class="p">())</span>

        <span class="c1"># Remove any keys that have been explicitly &quot;unset&quot;</span>
        <span class="n">unset_keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">[])):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unset_keys</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;prefect-logs_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_pool_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;logDriver&quot;</span><span class="p">:</span> <span class="s2">&quot;awslogs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;awslogs-create-group&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;awslogs-group&quot;</span><span class="p">:</span> <span class="s2">&quot;prefect&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;awslogs-region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                    <span class="s2">&quot;awslogs-stream-prefix&quot;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">configuration</span><span class="o">.</span><span class="n">cloudwatch_logs_prefix</span> <span class="ow">or</span> <span class="n">prefix</span>
                    <span class="p">),</span>
                    <span class="o">**</span><span class="n">configuration</span><span class="o">.</span><span class="n">cloudwatch_logs_options</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>

        <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_or_generate_family</span><span class="p">(</span>
            <span class="n">task_definition</span><span class="p">,</span> <span class="n">flow_run</span>
        <span class="p">)</span>
        <span class="c1"># CPU and memory are required in some cases, retrieve the value to use</span>
        <span class="n">cpu</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ECS_DEFAULT_CPU</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ECS_DEFAULT_MEMORY</span>

        <span class="n">launch_type</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="n">ECS_DEFAULT_LAUNCH_TYPE</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">or</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
            <span class="c1"># Task level memory and cpu are required when using fargate</span>
            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span>
            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>

            <span class="c1"># The FARGATE compatibility is required if it will be used as as launch type</span>
            <span class="n">requires_compatibilities</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                <span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">,</span> <span class="p">[]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">requires_compatibilities</span><span class="p">:</span>
                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FARGATE&quot;</span><span class="p">)</span>

            <span class="c1"># Only the &#39;awsvpc&#39; network mode is supported when using FARGATE</span>
            <span class="c1"># However, we will not enforce that here if the user has set it</span>
            <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">,</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;EC2&quot;</span><span class="p">:</span>
            <span class="c1"># Container level memory and cpu are required when using ec2</span>
            <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">cpu</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span>

            <span class="c1"># Ensure set values are cast to integers</span>
            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">])</span>
            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">])</span>

        <span class="c1"># Ensure set values are cast to strings</span>
        <span class="k">if</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">):</span>
            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">task_definition</span>

    <span class="k">def</span> <span class="nf">_load_network_configuration</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load settings from a specific VPC or the default VPC and generate a task</span>
<span class="sd">        run request&#39;s network configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ec2_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ec2&quot;</span><span class="p">)</span>
        <span class="n">vpc_message</span> <span class="o">=</span> <span class="s2">&quot;the default VPC&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;VPC with ID </span><span class="si">{</span><span class="n">vpc_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span><span class="p">:</span>
            <span class="c1"># Retrieve the default VPC</span>
            <span class="n">describe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Filters&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;isDefault&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;true&quot;</span><span class="p">]}]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">describe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;VpcIds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}</span>

        <span class="n">vpcs</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_vpcs</span><span class="p">(</span><span class="o">**</span><span class="n">describe</span><span class="p">)[</span><span class="s2">&quot;Vpcs&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpcs</span><span class="p">:</span>
            <span class="n">help_message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Pass an explicit `vpc_id` or configure a default VPC.&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span>
                <span class="k">else</span> <span class="s2">&quot;Check that the VPC exists in the current region.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to find </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Network configuration cannot be inferred. &quot;</span>
                <span class="o">+</span> <span class="n">help_message</span>
            <span class="p">)</span>

        <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">vpcs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;VpcId&quot;</span><span class="p">]</span>
        <span class="n">subnets</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_subnets</span><span class="p">(</span>
            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}]</span>
        <span class="p">)[</span><span class="s2">&quot;Subnets&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">subnets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to find subnets for </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Network configuration cannot be inferred.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;awsvpcConfiguration&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;subnets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;SubnetId&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subnets</span><span class="p">],</span>
                <span class="s2">&quot;assignPublicIp&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
                <span class="s2">&quot;securityGroups&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_custom_network_configuration</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vpc_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">network_configuration</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load settings from a specific VPC or the default VPC and generate a task</span>
<span class="sd">        run request&#39;s network configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ec2_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ec2&quot;</span><span class="p">)</span>
        <span class="n">vpc_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;VPC with ID </span><span class="si">{</span><span class="n">vpc_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">vpcs</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_vpcs</span><span class="p">(</span><span class="n">VpcIds</span><span class="o">=</span><span class="p">[</span><span class="n">vpc_id</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Vpcs&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpcs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to find </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Network configuration cannot be inferred. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Pass an explicit `vpc_id`.&quot;</span>
            <span class="p">)</span>

        <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">vpcs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;VpcId&quot;</span><span class="p">]</span>
        <span class="n">subnets</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_subnets</span><span class="p">(</span>
            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}]</span>
        <span class="p">)[</span><span class="s2">&quot;Subnets&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">subnets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to find subnets for </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Network configuration cannot be inferred.&quot;</span>
            <span class="p">)</span>

        <span class="n">subnet_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">subnet</span><span class="p">[</span><span class="s2">&quot;SubnetId&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">subnet</span> <span class="ow">in</span> <span class="n">subnets</span><span class="p">]</span>

        <span class="n">config_subnets</span> <span class="o">=</span> <span class="n">network_configuration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subnets&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">conf_sn</span> <span class="ow">in</span> <span class="n">subnet_ids</span> <span class="k">for</span> <span class="n">conf_sn</span> <span class="ow">in</span> <span class="n">config_subnets</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Subnets </span><span class="si">{</span><span class="n">config_subnets</span><span class="si">}</span><span class="s2"> not found within </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Please check that VPC is associated with supplied subnets.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;awsvpcConfiguration&quot;</span><span class="p">:</span> <span class="n">network_configuration</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_prepare_task_run_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">task_definition_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a task run request payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task_run_request</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="p">)</span>

        <span class="n">task_run_request</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">,</span> <span class="n">task_definition_arn</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_definition_arn</span>
        <span class="n">capacityProviderStrategy</span> <span class="o">=</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacityProviderStrategy&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">capacityProviderStrategy</span><span class="p">:</span>
            <span class="c1"># Should not be provided at all if capacityProviderStrategy is set, see https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_RunTask.html#ECS-RunTask-request-capacityProviderStrategy  # noqa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Found capacityProviderStrategy. &quot;</span>
                <span class="s2">&quot;Removing launchType from task run request.&quot;</span>
            <span class="p">)</span>
            <span class="n">task_run_request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
            <span class="c1"># Should not be provided at all for FARGATE SPOT</span>
            <span class="n">task_run_request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># A capacity provider strategy is required for FARGATE SPOT</span>
            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;capacityProviderStrategy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;capacityProvider&quot;</span><span class="p">:</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="n">overrides</span> <span class="o">=</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overrides&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">container_overrides</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containerOverrides&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Ensure the network configuration is present if using awsvpc for network mode</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awsvpc&quot;</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">network_configuration</span>
        <span class="p">):</span>
            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_network_configuration</span><span class="p">(</span>
                <span class="n">configuration</span><span class="o">.</span><span class="n">vpc_id</span><span class="p">,</span> <span class="n">configuration</span>
            <span class="p">)</span>

        <span class="c1"># Use networkConfiguration if supplied by user</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awsvpc&quot;</span>
            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">network_configuration</span>
            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">vpc_id</span>
        <span class="p">):</span>
            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_custom_network_configuration</span><span class="p">(</span>
                    <span class="n">configuration</span><span class="o">.</span><span class="n">vpc_id</span><span class="p">,</span>
                    <span class="n">configuration</span><span class="o">.</span><span class="n">network_configuration</span><span class="p">,</span>
                    <span class="n">configuration</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Ensure the container name is set if not provided at template time</span>

        <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
            <span class="ow">or</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">container_overrides</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container_overrides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="n">container_overrides</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">container_name</span>

        <span class="c1"># Ensure configuration command is respected post-templating</span>

        <span class="n">orchestration_container</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span><span class="n">container_overrides</span><span class="p">,</span> <span class="n">container_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">orchestration_container</span><span class="p">:</span>
            <span class="c1"># Override the command if given on the configuration</span>
            <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
                <span class="n">orchestration_container</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">command</span>

        <span class="c1"># Clean up templated variable formatting</span>

        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">container_overrides</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">container</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>

            <span class="c1"># Remove null values — they&#39;re not allowed by AWS</span>
            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">item</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">):</span>
            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">])</span>

        <span class="c1"># Ensure configuration tags and env are respected post-templating</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">item</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>

        <span class="c1"># Slugify tags keys and values</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">slugify</span><span class="p">(</span>
                    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span>
                    <span class="n">regex_pattern</span><span class="o">=</span><span class="n">_TAG_REGEX</span><span class="p">,</span>
                    <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">lowercase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">slugify</span><span class="p">(</span>
                    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
                    <span class="n">regex_pattern</span><span class="o">=</span><span class="n">_TAG_REGEX</span><span class="p">,</span>
                    <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">lowercase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tags</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span>

        <span class="k">if</span> <span class="n">orchestration_container</span><span class="p">:</span>
            <span class="n">environment</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">item</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">orchestration_container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">environment</span><span class="p">:</span>
                <span class="n">orchestration_container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environment</span>

        <span class="c1"># Remove empty container overrides</span>

        <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;containerOverrides&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">container_overrides</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">task_run_request</span>

    <span class="nd">@retry</span><span class="p">(</span>
        <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="n">MAX_CREATE_TASK_RUN_ATTEMPTS</span><span class="p">),</span>
        <span class="n">wait</span><span class="o">=</span><span class="n">wait_fixed</span><span class="p">(</span><span class="n">CREATE_TASK_RUN_MIN_DELAY_SECONDS</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">wait_random</span><span class="p">(</span>
            <span class="n">CREATE_TASK_RUN_MIN_DELAY_JITTER_SECONDS</span><span class="p">,</span>
            <span class="n">CREATE_TASK_RUN_MAX_DELAY_JITTER_SECONDS</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">reraise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_create_task_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span> <span class="n">task_run_request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a run of a task definition.</span>

<span class="sd">        Returns the task run ARN.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span><span class="o">**</span><span class="n">task_run_request</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;failures&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task: </span><span class="si">{</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to run ECS task: no tasks or failures were returned.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_task_definitions_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskdef_1</span><span class="p">,</span> <span class="n">taskdef_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare two task definitions.</span>

<span class="sd">        Since one may come from the AWS API and have populated defaults, we do our best</span>
<span class="sd">        to homogenize the definitions without changing their meaning.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">taskdef_1</span> <span class="o">==</span> <span class="n">taskdef_2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">taskdef_1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">taskdef_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">taskdef_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">taskdef_1</span><span class="p">)</span>
        <span class="n">taskdef_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">taskdef_2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">taskdef</span> <span class="ow">in</span> <span class="p">(</span><span class="n">taskdef_1</span><span class="p">,</span> <span class="n">taskdef_2</span><span class="p">):</span>
            <span class="c1"># Set defaults that AWS would set after registration</span>
            <span class="n">container_definitions</span> <span class="o">=</span> <span class="n">taskdef</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">essential</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;essential&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">container_definitions</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">essential</span><span class="p">:</span>
                <span class="n">container_definitions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;essential&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">taskdef</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">,</span> <span class="s2">&quot;bridge&quot;</span><span class="p">)</span>

        <span class="n">_drop_empty_keys_from_task_definition</span><span class="p">(</span><span class="n">taskdef_1</span><span class="p">)</span>
        <span class="n">_drop_empty_keys_from_task_definition</span><span class="p">(</span><span class="n">taskdef_2</span><span class="p">)</span>

        <span class="c1"># Clear fields that change on registration for comparison</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">ECS_POST_REGISTRATION_FIELDS</span><span class="p">:</span>
            <span class="n">taskdef_1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">taskdef_2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">taskdef_1</span> <span class="o">==</span> <span class="n">taskdef_2</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">kill_infrastructure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
        <span class="n">infrastructure_pid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill a task running on ECS.</span>

<span class="sd">        Args:</span>
<span class="sd">            infrastructure_pid: A cluster and task arn combination. This should match a</span>
<span class="sd">                value yielded by `ECSWorker.run`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">grace_seconds</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Kill grace period of </span><span class="si">{</span><span class="n">grace_seconds</span><span class="si">}</span><span class="s2">s requested, but AWS does not &quot;</span>
                <span class="s2">&quot;support dynamic grace period configuration so 30s will be used. &quot;</span>
                <span class="s2">&quot;See https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-agent-config.html for configuration of grace periods.&quot;</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>
        <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">parse_identifier</span><span class="p">(</span><span class="n">infrastructure_pid</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stop_task</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stop_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span> <span class="n">cluster</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop a running ECS task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cluster</span> <span class="o">!=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InfrastructureNotAvailable</span><span class="p">(</span>
                <span class="s2">&quot;Cannot stop ECS task: this infrastructure block has access to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;cluster </span><span class="si">{</span><span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> but the task is running in cluster &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">ecs_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ecs&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ecs_client</span><span class="o">.</span><span class="n">stop_task</span><span class="p">(</span><span class="n">cluster</span><span class="o">=</span><span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="c1"># Raise a special exception if the task does not exist</span>
            <span class="k">if</span> <span class="s2">&quot;ClusterNotFound&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> could not be found.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
            <span class="k">if</span> <span class="s2">&quot;not find task&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;referenced task was not found&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">exc</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the task </span><span class="si">{</span><span class="n">task</span><span class="si">!r}</span><span class="s2"> could not be found in &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2">.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
            <span class="k">if</span> <span class="s2">&quot;no registered tasks&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> has no tasks.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

            <span class="c1"># Reraise unknown exceptions</span>
            <span class="k">raise</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






<h4 id="prefect_aws.workers.ecs_worker.ECSWorker-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration" class="doc doc-heading">
        <code>
job_configuration            (<span title="prefect.workers.base.BaseJobConfiguration">BaseJobConfiguration</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Job configuration for an ECS worker.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ECSJobConfiguration</span><span class="p">(</span><span class="n">BaseJobConfiguration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Job configuration for an ECS worker.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aws_credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AwsCredentials</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">AwsCredentials</span><span class="p">)</span>
    <span class="n">task_definition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">template</span><span class="o">=</span><span class="n">_default_task_definition_template</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">task_run_request</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">template</span><span class="o">=</span><span class="n">_default_task_run_request_template</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">configure_cloudwatch_logs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">cloudwatch_logs_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">cloudwatch_logs_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">network_configuration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">stream_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">task_start_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">task_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">auto_deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">container_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">match_latest_revision_in_family</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">task_run_request_requires_arn_if_no_task_definition_given</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If no task definition is provided, a task definition ARN must be present on the</span>
<span class="sd">        task run request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;taskDefinition&quot;</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A task definition must be provided if a task definition ARN is not &quot;</span>
                <span class="s2">&quot;present on the task run request.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">container_name_default_from_task_definition</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Infers the container name from the task definition if not provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;container_name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;container_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span>
                <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># We may not have a name here still; for example if someone is using a task</span>
            <span class="c1"># definition arn. In that case, we&#39;ll perform similar logic later to find</span>
            <span class="c1"># the name to treat as the &quot;orchestration&quot; container.</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_default_configure_cloudwatch_logs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streaming output generally requires CloudWatch logs to be configured.</span>

<span class="sd">        To avoid entangled arguments in the simple case, `configure_cloudwatch_logs`</span>
<span class="sd">        defaults to matching the value of `stream_output`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">configure_cloudwatch_logs</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">configure_cloudwatch_logs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream_output&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">configure_cloudwatch_logs_requires_execution_role_arn</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">        runtime task definition) when configuring logging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_role_arn&quot;</span><span class="p">)</span>
            <span class="c1"># TODO: Does not match</span>
            <span class="c1"># Do not raise if they&#39;ve linked to another task definition or provided</span>
            <span class="c1"># it without using our shortcuts</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;An `execution_role_arn` must be provided to use &quot;</span>
                <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs`.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">        runtime task definition) when configuring logging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cloudwatch_logs_options&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;configure_cloudwatch_logs&quot;</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`configure_cloudwatch_log` must be enabled to use &quot;</span>
                <span class="s2">&quot;`cloudwatch_logs_options`.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">network_configuration_requires_vpc_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces a `vpc_id` is provided when custom network configuration mode is</span>
<span class="sd">        enabled for network settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;network_configuration&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vpc_id&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;You must provide a `vpc_id` to enable custom `network_configuration`.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




































<h6 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration-methods">Methods</h6>


  <div class="doc doc-object doc-method">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration.cloudwatch_logs_options_requires_configure_cloudwatch_logs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Enforces that an execution role arn is provided (or could be provided by a
runtime task definition) when configuring logging.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">    runtime task definition) when configuring logging.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cloudwatch_logs_options&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;configure_cloudwatch_logs&quot;</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;`configure_cloudwatch_log` must be enabled to use &quot;</span>
            <span class="s2">&quot;`cloudwatch_logs_options`.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration.configure_cloudwatch_logs_requires_execution_role_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_cloudwatch_logs_requires_execution_role_arn</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Enforces that an execution role arn is provided (or could be provided by a
runtime task definition) when configuring logging.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">configure_cloudwatch_logs_requires_execution_role_arn</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforces that an execution role arn is provided (or could be provided by a</span>
<span class="sd">    runtime task definition) when configuring logging.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_role_arn&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: Does not match</span>
        <span class="c1"># Do not raise if they&#39;ve linked to another task definition or provided</span>
        <span class="c1"># it without using our shortcuts</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;An `execution_role_arn` must be provided to use &quot;</span>
            <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs`.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration.container_name_default_from_task_definition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">container_name_default_from_task_definition</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Infers the container name from the task definition if not provided.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">container_name_default_from_task_definition</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Infers the container name from the task definition if not provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;container_name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;container_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span>
            <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># We may not have a name here still; for example if someone is using a task</span>
        <span class="c1"># definition arn. In that case, we&#39;ll perform similar logic later to find</span>
        <span class="c1"># the name to treat as the &quot;orchestration&quot; container.</span>

    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration.network_configuration_requires_vpc_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">network_configuration_requires_vpc_id</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Enforces a <code>vpc_id</code> is provided when custom network configuration mode is
enabled for network settings.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">network_configuration_requires_vpc_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforces a `vpc_id` is provided when custom network configuration mode is</span>
<span class="sd">    enabled for network settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;network_configuration&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vpc_id&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;You must provide a `vpc_id` to enable custom `network_configuration`.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration.set_default_configure_cloudwatch_logs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_default_configure_cloudwatch_logs</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Streaming output generally requires CloudWatch logs to be configured.</p>
<p>To avoid entangled arguments in the simple case, <code>configure_cloudwatch_logs</code>
defaults to matching the value of <code>stream_output</code>.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_default_configure_cloudwatch_logs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Streaming output generally requires CloudWatch logs to be configured.</span>

<span class="sd">    To avoid entangled arguments in the simple case, `configure_cloudwatch_logs`</span>
<span class="sd">    defaults to matching the value of `stream_output`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">configure_cloudwatch_logs</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">configure_cloudwatch_logs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream_output&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration.task_run_request_requires_arn_if_no_task_definition_given" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_run_request_requires_arn_if_no_task_definition_given</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>If no task definition is provided, a task definition ARN must be present on the
task run request.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@root_validator</span>
<span class="k">def</span> <span class="nf">task_run_request_requires_arn_if_no_task_definition_given</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If no task definition is provided, a task definition ARN must be present on the</span>
<span class="sd">    task run request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;taskDefinition&quot;</span>
    <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;A task definition must be provided if a task definition ARN is not &quot;</span>
            <span class="s2">&quot;present on the task run request.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables" class="doc doc-heading">
        <code>
job_configuration_variables            (<span title="prefect.workers.base.BaseVariables">BaseVariables</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Variables for templating an ECS job.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ECSVariables</span><span class="p">(</span><span class="n">BaseVariables</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variables for templating an ECS job.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">task_definition_arn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;An identifier for an existing task definition to use. If set, options that&quot;</span>
            <span class="s2">&quot; require changes to the task definition will be ignored. All contents of &quot;</span>
            <span class="s2">&quot;the task definition in the job configuration will be ignored.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Environment Variables&quot;</span><span class="p">,</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Environment variables to provide to the task run. These variables are set &quot;</span>
            <span class="s2">&quot;on the Prefect container at task runtime. These will not be set on the &quot;</span>
            <span class="s2">&quot;task definition.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">aws_credentials</span><span class="p">:</span> <span class="n">AwsCredentials</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Credentials&quot;</span><span class="p">,</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">AwsCredentials</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The AWS credentials to use to connect to ECS. If not provided, credentials&quot;</span>
            <span class="s2">&quot; will be inferred from the local environment following AWS&#39;s boto client&#39;s&quot;</span>
            <span class="s2">&quot; rules.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The ECS cluster to run the task in. An ARN or name may be provided. If &quot;</span>
            <span class="s2">&quot;not provided, the default cluster will be used.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">family</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A family for the task definition. If not provided, it will be inferred &quot;</span>
            <span class="s2">&quot;from the task definition. If the task definition does not have a family, &quot;</span>
            <span class="s2">&quot;the name will be generated. When flow and deployment metadata is &quot;</span>
            <span class="s2">&quot;available, the generated name will include their names. Values for this &quot;</span>
            <span class="s2">&quot;field will be slugified to match AWS character requirements.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">launch_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FARGATE&quot;</span><span class="p">,</span> <span class="s2">&quot;EC2&quot;</span><span class="p">,</span> <span class="s2">&quot;EXTERNAL&quot;</span><span class="p">,</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Field</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">ECS_DEFAULT_LAUNCH_TYPE</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;The type of ECS task run infrastructure that should be used. Note that&quot;</span>
                <span class="s2">&quot; &#39;FARGATE_SPOT&#39; is not a formal ECS launch type, but we will configure&quot;</span>
                <span class="s2">&quot; the proper capacity provider strategy if set here.&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">capacity_provider_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CapacityProvider</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The capacity provider strategy to use when running the task. &quot;</span>
            <span class="s2">&quot;If a capacity provider strategy is specified, the selected launch&quot;</span>
            <span class="s2">&quot; type will be ignored.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The image to use for the Prefect container in the task. If this value is &quot;</span>
            <span class="s2">&quot;not null, it will override the value in the task definition. This value &quot;</span>
            <span class="s2">&quot;defaults to a Prefect base image matching your local versions.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cpu</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of CPU to provide to the ECS task. Valid amounts are &quot;</span>
            <span class="s2">&quot;specified in the AWS documentation. If not provided, a default value of &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_CPU</span><span class="si">}</span><span class="s2"> will be used unless present on the task definition.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of memory to provide to the ECS task. Valid amounts are &quot;</span>
            <span class="s2">&quot;specified in the AWS documentation. If not provided, a default value of &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_MEMORY</span><span class="si">}</span><span class="s2"> will be used unless present on the task definition.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The name of the container flow run orchestration will occur in. If not &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;specified, a default value of </span><span class="si">{</span><span class="n">ECS_DEFAULT_CONTAINER_NAME</span><span class="si">}</span><span class="s2"> will be used &quot;</span>
            <span class="s2">&quot;and if that is not found in the task definition the first container will &quot;</span>
            <span class="s2">&quot;be used.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">task_role_arn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Task Role ARN&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A role to attach to the task run. This controls the permissions of the &quot;</span>
            <span class="s2">&quot;task while it is running.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">execution_role_arn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Execution Role ARN&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;An execution role to use for the task. This controls the permissions of &quot;</span>
            <span class="s2">&quot;the task when it is launching. If this value is not null, it will &quot;</span>
            <span class="s2">&quot;override the value in the task definition. An execution role must be &quot;</span>
            <span class="s2">&quot;provided to capture logs from the container.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;VPC ID&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The AWS VPC to link the task run to. This is only applicable when using &quot;</span>
            <span class="s2">&quot;the &#39;awsvpc&#39; network mode for your task. FARGATE tasks require this &quot;</span>
            <span class="s2">&quot;network  mode, but for EC2 tasks the default network mode is &#39;bridge&#39;. &quot;</span>
            <span class="s2">&quot;If using the &#39;awsvpc&#39; network mode and this field is null, your default &quot;</span>
            <span class="s2">&quot;VPC will be used. If no default VPC can be found, the task run will fail.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">configure_cloudwatch_logs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, the Prefect container will be configured to send its output &quot;</span>
            <span class="s2">&quot;to the AWS CloudWatch logs service. This functionality requires an &quot;</span>
            <span class="s2">&quot;execution role with logs:CreateLogStream, logs:CreateLogGroup, and &quot;</span>
            <span class="s2">&quot;logs:PutLogEvents permissions. The default for this field is `False` &quot;</span>
            <span class="s2">&quot;unless `stream_output` is set.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cloudwatch_logs_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;When `configure_cloudwatch_logs` is enabled, this setting may be used to&quot;</span>
            <span class="s2">&quot; pass additional options to the CloudWatch logs configuration or override&quot;</span>
            <span class="s2">&quot; the default options. See the [AWS&quot;</span>
            <span class="s2">&quot; documentation](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/using_awslogs.html#create_awslogs_logdriver_options)&quot;</span>  <span class="c1"># noqa</span>
            <span class="s2">&quot; for available options. &quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">cloudwatch_logs_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;When `configure_cloudwatch_logs` is enabled, this setting may be used to&quot;</span>
            <span class="s2">&quot; set a prefix for the log group. If not provided, the default prefix will&quot;</span>
            <span class="s2">&quot; be `prefect-logs_&lt;work_pool_name&gt;_&lt;deployment_id&gt;`. If&quot;</span>
            <span class="s2">&quot; `awslogs-stream-prefix` is present in `Cloudwatch logs options` this&quot;</span>
            <span class="s2">&quot; setting will be ignored.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">network_configuration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;When `network_configuration` is supplied it will override ECS Worker&#39;s&quot;</span>
            <span class="s2">&quot;awsvpcConfiguration that defined in the ECS task executing your workload. &quot;</span>
            <span class="s2">&quot;See the [AWS documentation](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-awsvpcconfiguration.html)&quot;</span>  <span class="c1"># noqa</span>
            <span class="s2">&quot; for available options.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">stream_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, logs will be streamed from the Prefect container to the local &quot;</span>
            <span class="s2">&quot;console. Unless you have configured AWS CloudWatch logs manually on your &quot;</span>
            <span class="s2">&quot;task definition, this requires the same prerequisites outlined in &quot;</span>
            <span class="s2">&quot;`configure_cloudwatch_logs`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">task_start_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of time to watch for the start of the ECS task &quot;</span>
            <span class="s2">&quot;before marking it as failed. The task must enter a RUNNING state to be &quot;</span>
            <span class="s2">&quot;considered started.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">task_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The amount of time to wait between AWS API calls while monitoring the &quot;</span>
            <span class="s2">&quot;state of an ECS task.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">auto_deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, any task definitions that are created by this block will be &quot;</span>
            <span class="s2">&quot;deregistered. Existing task definitions linked by ARN will never be &quot;</span>
            <span class="s2">&quot;deregistered. Deregistering a task definition does not remove it from &quot;</span>
            <span class="s2">&quot;your AWS account, instead it will be marked as INACTIVE.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">match_latest_revision_in_family</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If enabled, the most recent active revision in the task definition &quot;</span>
            <span class="s2">&quot;family will be compared against the desired ECS task configuration. &quot;</span>
            <span class="s2">&quot;If they are equal, the existing task definition will be used instead &quot;</span>
            <span class="s2">&quot;of registering a new one. If no family is specified the default family &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s1">&quot; will be used.&#39;</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h6 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables-attributes">Attributes</h6>














  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.auto_deregister_task_definition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>If enabled, any task definitions that are created by this block will be deregistered. Existing task definitions linked by ARN will never be deregistered. Deregistering a task definition does not remove it from your AWS account, instead it will be marked as INACTIVE.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.aws_credentials" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aws_credentials</span><span class="p">:</span> <span class="n">AwsCredentials</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The AWS credentials to use to connect to ECS. If not provided, credentials will be inferred from the local environment following AWS's boto client's rules.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.capacity_provider_strategy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">capacity_provider_strategy</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">prefect_aws</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">ecs_worker</span><span class="o">.</span><span class="n">CapacityProvider</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The capacity provider strategy to use when running the task. If a capacity provider strategy is specified, the selected launch type will be ignored.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.cloudwatch_logs_options" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cloudwatch_logs_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>When <code>configure_cloudwatch_logs</code> is enabled, this setting may be used to pass additional options to the CloudWatch logs configuration or override the default options. See the <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/using_awslogs.html#create_awslogs_logdriver_options">AWS documentation</a> for available options. </p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.cloudwatch_logs_prefix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cloudwatch_logs_prefix</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>When <code>configure_cloudwatch_logs</code> is enabled, this setting may be used to set a prefix for the log group. If not provided, the default prefix will be <code>prefect-logs_&lt;work_pool_name&gt;_&lt;deployment_id&gt;</code>. If <code>awslogs-stream-prefix</code> is present in <code>Cloudwatch logs options</code> this setting will be ignored.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.cluster" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cluster</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The ECS cluster to run the task in. An ARN or name may be provided. If not provided, the default cluster will be used.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.configure_cloudwatch_logs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_cloudwatch_logs</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>If enabled, the Prefect container will be configured to send its output to the AWS CloudWatch logs service. This functionality requires an execution role with logs:CreateLogStream, logs:CreateLogGroup, and logs:PutLogEvents permissions. The default for this field is <code>False</code> unless <code>stream_output</code> is set.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.container_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The name of the container flow run orchestration will occur in. If not specified, a default value of prefect will be used and if that is not found in the task definition the first container will be used.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.cpu" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cpu</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The amount of CPU to provide to the ECS task. Valid amounts are specified in the AWS documentation. If not provided, a default value of 1024 will be used unless present on the task definition.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.execution_role_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">execution_role_arn</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>An execution role to use for the task. This controls the permissions of the task when it is launching. If this value is not null, it will override the value in the task definition. An execution role must be provided to capture logs from the container.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.family" class="doc doc-heading">
<code class="highlight language-python"><span class="n">family</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>A family for the task definition. If not provided, it will be inferred from the task definition. If the task definition does not have a family, the name will be generated. When flow and deployment metadata is available, the generated name will include their names. Values for this field will be slugified to match AWS character requirements.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">image</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The image to use for the Prefect container in the task. If this value is not null, it will override the value in the task definition. This value defaults to a Prefect base image matching your local versions.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.launch_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FARGATE&#39;</span><span class="p">,</span> <span class="s1">&#39;EC2&#39;</span><span class="p">,</span> <span class="s1">&#39;EXTERNAL&#39;</span><span class="p">,</span> <span class="s1">&#39;FARGATE_SPOT&#39;</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The type of ECS task run infrastructure that should be used. Note that 'FARGATE_SPOT' is not a formal ECS launch type, but we will configure the proper capacity provider strategy if set here.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.match_latest_revision_in_family" class="doc doc-heading">
<code class="highlight language-python"><span class="n">match_latest_revision_in_family</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>If enabled, the most recent active revision in the task definition family will be compared against the desired ECS task configuration. If they are equal, the existing task definition will be used instead of registering a new one. If no family is specified the default family "prefect" will be used.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.memory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">memory</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The amount of memory to provide to the ECS task. Valid amounts are specified in the AWS documentation. If not provided, a default value of 2048 will be used unless present on the task definition.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.network_configuration" class="doc doc-heading">
<code class="highlight language-python"><span class="n">network_configuration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>When <code>network_configuration</code> is supplied it will override ECS Worker'sawsvpcConfiguration that defined in the ECS task executing your workload. See the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-awsvpcconfiguration.html">AWS documentation</a> for available options.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.stream_output" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stream_output</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>If enabled, logs will be streamed from the Prefect container to the local console. Unless you have configured AWS CloudWatch logs manually on your task definition, this requires the same prerequisites outlined in <code>configure_cloudwatch_logs</code>.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.task_definition_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_definition_arn</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>An identifier for an existing task definition to use. If set, options that require changes to the task definition will be ignored. All contents of the task definition in the job configuration will be ignored.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.task_role_arn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_role_arn</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>A role to attach to the task run. This controls the permissions of the task while it is running.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.task_start_timeout_seconds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_start_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The amount of time to watch for the start of the ECS task before marking it as failed. The task must enter a RUNNING state to be considered started.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.task_watch_poll_interval" class="doc doc-heading">
<code class="highlight language-python"><span class="n">task_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The amount of time to wait between AWS API calls while monitoring the state of an ECS task.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h7 id="prefect_aws.workers.ecs_worker.ECSWorker.job_configuration_variables.vpc_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">vpc_id</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The AWS VPC to link the task run to. This is only applicable when using the 'awsvpc' network mode for your task. FARGATE tasks require this network  mode, but for EC2 tasks the default network mode is 'bridge'. If using the 'awsvpc' network mode and this field is null, your default VPC will be used. If no default VPC can be found, the task run will fail.</p>
    </div>

  </div>










  </div>

    </div>

  </div>



<h4 id="prefect_aws.workers.ecs_worker.ECSWorker-methods">Methods</h4>

  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSWorker.kill_infrastructure" class="doc doc-heading">
<code class="highlight language-python"><span class="n">kill_infrastructure</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Kill a task running on ECS.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>infrastructure_pid</code></td>
        <td><code>str</code></td>
        <td><p>A cluster and task arn combination. This should match a
value yielded by <code>ECSWorker.run</code>.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">kill_infrastructure</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
    <span class="n">infrastructure_pid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kill a task running on ECS.</span>

<span class="sd">    Args:</span>
<span class="sd">        infrastructure_pid: A cluster and task arn combination. This should match a</span>
<span class="sd">            value yielded by `ECSWorker.run`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">grace_seconds</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Kill grace period of </span><span class="si">{</span><span class="n">grace_seconds</span><span class="si">}</span><span class="s2">s requested, but AWS does not &quot;</span>
            <span class="s2">&quot;support dynamic grace period configuration so 30s will be used. &quot;</span>
            <span class="s2">&quot;See https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-agent-config.html for configuration of grace periods.&quot;</span>  <span class="c1"># noqa</span>
        <span class="p">)</span>
    <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">parse_identifier</span><span class="p">(</span><span class="n">infrastructure_pid</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stop_task</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="prefect_aws.workers.ecs_worker.ECSWorker.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Runs a given flow run on the current worker.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">flow_run</span><span class="p">:</span> <span class="s2">&quot;FlowRun&quot;</span><span class="p">,</span>
    <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
    <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">anyio</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseWorkerResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a given flow run on the current worker.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ecs_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ecs&quot;</span>
    <span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flow_run_logger</span><span class="p">(</span><span class="n">flow_run</span><span class="p">)</span>

    <span class="p">(</span>
        <span class="n">task_arn</span><span class="p">,</span>
        <span class="n">cluster_arn</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">,</span>
        <span class="n">is_new_task_definition</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_and_wait_for_start</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">,</span>
        <span class="n">flow_run</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># The task identifier is &quot;{cluster}::{task}&quot; where we use the configured cluster</span>
    <span class="c1"># if set to preserve matching by name rather than arn</span>
    <span class="c1"># Note &quot;::&quot; is used despite the Prefect standard being &quot;:&quot; because ARNs contain</span>
    <span class="c1"># single colons.</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">else</span> <span class="n">cluster_arn</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot;::&quot;</span>
        <span class="o">+</span> <span class="n">task_arn</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
        <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

    <span class="n">status_code</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_and_get_exit_code</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">,</span>
        <span class="n">task_arn</span><span class="p">,</span>
        <span class="n">cluster_arn</span><span class="p">,</span>
        <span class="n">task_definition</span><span class="p">,</span>
        <span class="n">is_new_task_definition</span> <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">auto_deregister_task_definition</span><span class="p">,</span>
        <span class="n">ecs_client</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ECSWorkerResult</span><span class="p">(</span>
        <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
        <span class="c1"># If the container does not start the exit code can be null but we must</span>
        <span class="c1"># still report a status code. We use a -1 to indicate a special code.</span>
        <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="prefect_aws.workers.ecs_worker.ECSWorkerResult" class="doc doc-heading">
        <code>
ECSWorkerResult            (<span title="prefect.workers.base.BaseWorkerResult">BaseWorkerResult</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>The result of an ECS job.</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ECSWorkerResult</span><span class="p">(</span><span class="n">BaseWorkerResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The result of an ECS job.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>


<h2 id="prefect_aws.workers.ecs_worker-functions">Functions</h2>



  <div class="doc doc-object doc-function">



<h3 id="prefect_aws.workers.ecs_worker.parse_identifier" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_identifier</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Splits identifier into its cluster and task components, e.g.
input "cluster_name::task_arn" outputs ("cluster_name", "task_arn").</p>

        <details class="quote">
          <summary>Source code in <code>prefect_aws/workers/ecs_worker.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ECSIdentifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits identifier into its cluster and task components, e.g.</span>
<span class="sd">    input &quot;cluster_name::task_arn&quot; outputs (&quot;cluster_name&quot;, &quot;task_arn&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ECSIdentifier</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.prefect.io/slack/" target="_blank" rel="noopener" title="www.prefect.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discourse.prefect.io/" target="_blank" rel="noopener" title="discourse.prefect.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M225.9 32C103.3 32 0 130.5 0 252.1 0 256 .1 480 .1 480l225.8-.2c122.7 0 222.1-102.3 222.1-223.9C448 134.3 348.6 32 225.9 32zM224 384c-19.4 0-37.9-4.3-54.4-12.1L88.5 392l22.9-75c-9.8-18.1-15.4-38.9-15.4-61 0-70.7 57.3-128 128-128s128 57.3 128 128-57.3 128-128 128z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/c/PrefectIO/videos" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://prefect.io/guide/" target="_blank" rel="noopener" title="prefect.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M168 80c-13.3 0-24 10.7-24 24v304c0 8.4-1.4 16.5-4.1 24H440c13.3 0 24-10.7 24-24V104c0-13.3-10.7-24-24-24H168zM72 480c-39.8 0-72-32.2-72-72V112c0-13.3 10.7-24 24-24s24 10.7 24 24v296c0 13.3 10.7 24 24 24s24-10.7 24-24V104c0-39.8 32.2-72 72-72h272c39.8 0 72 32.2 72 72v304c0 39.8-32.2 72-72 72H72zm104-344c0-13.3 10.7-24 24-24h96c13.3 0 24 10.7 24 24v80c0 13.3-10.7 24-24 24h-96c-13.3 0-24-10.7-24-24v-80zm200-24h32c13.3 0 24 10.7 24 24s-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80h32c13.3 0 24 10.7 24 24s-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24s10.7-24 24-24zm-176 80h208c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80h208c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/PrefectIO" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/prefect/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/PrefectHQ/prefect" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/r/prefecthq/prefect/" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/prefect/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
    
  </body>
</html>